<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="simple life"><title>OpenWrt中使用gdb分析coredump | LITREILY</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OpenWrt中使用gdb分析coredump</h1><a id="logo" href="/.">LITREILY</a><p class="description">Stay Hungry, Stay Foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="https://litreily.gitbooks.io/notes/"><i class="fa fa-book"> Notes</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/history/"><i class="fa fa-history"> History</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OpenWrt中使用gdb分析coredump</h1><div class="post-meta">Sep 20, 2018<span> | </span><span class="category"><a href="/categories/嵌入式/">嵌入式</a></span></div><a class="disqus-comment-count" href="/2018/09/20/coredump/#vcomment"><span class="valine-comment-count" data-xid="/2018/09/20/coredump/"></span><span> Comment</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#调试背景"><span class="toc-number">1.</span> <span class="toc-text">调试背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译gdb以及带symbols的程序"><span class="toc-number">2.</span> <span class="toc-text">编译gdb以及带symbols的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置编译参数"><span class="toc-number">2.1.</span> <span class="toc-text">配置编译参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译单个模块-package"><span class="toc-number">2.2.</span> <span class="toc-text">编译单个模块(package)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#完整编译"><span class="toc-number">2.3.</span> <span class="toc-text">完整编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取coredump"><span class="toc-number">3.</span> <span class="toc-text">获取coredump</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置coredump参数"><span class="toc-number">3.1.</span> <span class="toc-text">配置coredump参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重现bug并获取coredump文件"><span class="toc-number">3.2.</span> <span class="toc-text">重现bug并获取coredump文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDB调试"><span class="toc-number">4.</span> <span class="toc-text">GDB调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用指令"><span class="toc-number">4.1.</span> <span class="toc-text">常用指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调试实例"><span class="toc-number">4.2.</span> <span class="toc-text">调试实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-number">4.3.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文档"><span class="toc-number">5.</span> <span class="toc-text">参考文档</span></a></li></ol></div></div><div class="post-content"><p>近日调试一个<code>bug</code>，一个守护进程在特定情况下执行一段程序后便会挂掉。为了分析<code>bug</code>产生原因，本人使用了printf, strace追踪，gdb调试等诸多调试工具和测试方法。本文对于在<code>OpenWrt</code>嵌入式系统中启用<code>gdb</code>功能及其使用方法进行详细说明。</p>
<h2 id="调试背景"><a href="#调试背景" class="headerlink" title="调试背景"></a>调试背景</h2><p>我最先通过<code>strace</code>工具追踪发现进程是在收到<code>SIGABRT</code>信号后被<code>kill</code>的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pipe([<span class="number">8</span>, <span class="number">9</span>])                            = <span class="number">0</span></span><br><span class="line">fcntl64(<span class="number">8</span>, F_GETFL)                     = <span class="number">0</span> (flags O_RDONLY)</span><br><span class="line">ioctl(<span class="number">8</span>, SNDCTL_TMR_TIMEBASE <span class="keyword">or</span> TCGETS, <span class="number">0xbe90a454</span>) = <span class="number">-1</span> EINVAL (Invalid argument)</span><br><span class="line">rt_sigprocmask(SIG_UNBLOCK, [ABRT], <span class="literal">NULL</span>, <span class="number">8</span>) = <span class="number">0</span></span><br><span class="line">tgkill(<span class="number">14189</span>, <span class="number">14189</span>, SIGABRT)             = <span class="number">0</span></span><br><span class="line">--- SIGABRT (Aborted) @ <span class="number">0</span> (<span class="number">0</span>) ---</span><br><span class="line">Process <span class="number">14189</span> detached</span><br></pre></td></tr></table></figure>
<p>由以上信息可知，进程在执行某个管道<code>pipe</code>相关操作时被<code>kill</code>，通常是在执行<code>popen</code>函数会出现<code>pipe</code>调用。之后对源码<code>grep -rn popen</code>， 并结合<code>strace</code>打印的出错前的信息可以大致定位到可能出错的位置，然后通过添加<code>printf</code>打印<code>log</code>，根据重现时停止打印<code>log</code>的地方精确定位到源码出错位置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.c</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> * <span class="title">config_get</span><span class="params">(<span class="keyword">char</span> *name)</span> </span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">128</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">snprintf</span>(cmd, <span class="keyword">sizeof</span>(cmd)<span class="number">-1</span>, <span class="string">"config get %s"</span>, name);</span><br><span class="line">    fp = popen(cmd, <span class="string">"r"</span>);   <span class="comment">// 出错位置</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，仅仅能判断出用户态的出错位置，但从此处代码尚无法明确出错的根本原因，还需抓取内核态的出错信息，此时便需要使用<code>GDB</code>对进程出错时系统生成的<code>coredump</code>文件进行分析了。</p>
<h2 id="编译gdb以及带symbols的程序"><a href="#编译gdb以及带symbols的程序" class="headerlink" title="编译gdb以及带symbols的程序"></a>编译gdb以及带symbols的程序</h2><p>在分析之前，需要被调试进程的二进制文件包含<code>GDB</code>分析所需的<code>symbols</code>，什么是<code>symbols</code>? 粗略的讲，就是一张嵌入待调试进程的二进制文件中的映射表，包含代码中的变量、函数名、行号等信息。详见<a href="https://www.tutorialspoint.com/gnu_debugger/gdb_debugging_symbols.htm" target="_blank" rel="noopener">GDB-Debugging Symbols</a></p>
<h3 id="配置编译参数"><a href="#配置编译参数" class="headerlink" title="配置编译参数"></a>配置编译参数</h3><p><code>OpenWrt</code>编译参数存于<code>.config</code>文件中，<code>OpenWrt</code>默认并未打开<code>gdb</code>功能以及<code>debug</code>调试功能，我们可以通过<code>make menuconfig</code>选择参数或者手动更改配置文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .config</span></span><br><span class="line">CONFIG_DEBUG=y <span class="comment"># 使能调试功能，启用后会给集成GDB调试所需的symbols</span></span><br><span class="line">CONFIG_NO_STRIP=y <span class="comment"># 禁用strip，防止程序代码被打乱</span></span><br><span class="line"><span class="comment">#CONFIG_USE_SSTRIP=y</span></span><br><span class="line">CONFIG_TOOLCHAINOPTS=y <span class="comment"># 使能交叉工具链可选功能，这是编译GDB功能的总开关</span></span><br></pre></td></tr></table></figure>
<p>配置完成后重新编译交叉工具链，用以得到<code>gdb</code>工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make toolchain/&#123;compile,install&#125; V=s</span><br></pre></td></tr></table></figure>
<h3 id="编译单个模块-package"><a href="#编译单个模块-package" class="headerlink" title="编译单个模块(package)"></a>编译单个模块(package)</h3><p>参考<code>OpenWrt</code>官方<a href="https://wiki.openwrt.org/doc/devel/gdb?s[]=gdb" target="_blank" rel="noopener">文档</a>，可以使用以下指令单独为一个模块添加<code>debug symbols</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make package/traffic_meter/&#123;clean,compile,install&#125; V=99 CONFIG_DEBUG=y</span><br></pre></td></tr></table></figure>
<h3 id="完整编译"><a href="#完整编译" class="headerlink" title="完整编译"></a>完整编译</h3><p>如果将全局<code>debug</code>开启，并进行完整编译，这会导致<code>image</code>过大（&gt;300M）而编译失败。当然啦，编译失败不要紧，因为只是没有生成<code>image</code>文件，但是所需模块和动态链接库都能正常编译完成，并不影响<code>coredump</code>文件的分析。</p>
<p>不过完整编译太过费时，不推荐，还是对需要调试的单个模块进行编译比较快捷和方便。</p>
<h2 id="获取coredump"><a href="#获取coredump" class="headerlink" title="获取coredump"></a>获取coredump</h2><p>得到了带有<code>symbols</code>的二进制文件，以及交叉编译得到的<code>gdb</code>调试工具，剩下的就是获取<code>coredump</code>文件</p>
<h3 id="配置coredump参数"><a href="#配置coredump参数" class="headerlink" title="配置coredump参数"></a>配置coredump参数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/profile</span><br><span class="line"><span class="comment"># 在文件末尾添加以下指令，以取消对coredump文件大小的限制</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置coredump文件命名格式</span></span><br><span class="line"><span class="comment"># e - process name; p - pid; t - time</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"core-%e-%p-%t"</span> &gt; /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>
<p>关于<code>coredump</code>文件格式的参数说明，可以参考<a href="http://man7.org/linux/man-pages/man5/core.5.html" target="_blank" rel="noopener">core dump file</a></p>
<h3 id="重现bug并获取coredump文件"><a href="#重现bug并获取coredump文件" class="headerlink" title="重现bug并获取coredump文件"></a>重现bug并获取coredump文件</h3><p>首先重现bug，然后找到<code>coredump</code>文件，并传至编译服务器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /</span><br><span class="line">$ find . -name <span class="string">"core-*"</span> |grep traffic_meter</span><br><span class="line">./sbin/core-traffic_meter-14189-2895</span><br><span class="line">$ <span class="built_in">cd</span> sbin</span><br><span class="line">$ tftp -pl core-traffic_meter-14189-2895 192.168.1.10</span><br></pre></td></tr></table></figure>
<h2 id="GDB调试"><a href="#GDB调试" class="headerlink" title="GDB调试"></a>GDB调试</h2><h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><p>下面是常用的几个<code>gdb</code>指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">help</span></span><br><span class="line">(gdb) <span class="built_in">where</span></span><br><span class="line">(gdb) bt    <span class="comment"># backtrace</span></span><br><span class="line">(gdb) list  <span class="comment"># [l] 显示当前调试处的相关代码</span></span><br><span class="line">(gdb) up [num]  <span class="comment"># 向上跳转1个或num个bt</span></span><br><span class="line">(gdb) down [num]    <span class="comment"># 向下跳转1个或num个bt</span></span><br><span class="line">(gdb) <span class="built_in">print</span> [variable]  <span class="comment"># [p] 打印当前调试处相关变量的值</span></span><br></pre></td></tr></table></figure>
<h3 id="调试实例"><a href="#调试实例" class="headerlink" title="调试实例"></a>调试实例</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> repo.git</span><br><span class="line">$ <span class="built_in">cd</span> build_dir/target-arm_v7=a_uClibc-0.9.33.2_eabi/root-ipq806x</span><br><span class="line">$ ../../toolchain-arm_v7-a_gcc-4.6-linaro_uClibc-0.9.33.2_eabi/gdb-linaro-7.2-2011.03-0/gdb/gdb sbin/traffic_meter ~/core-traffic_meter-14189-28959-2895</span><br><span class="line">GNU gdb (Linaro GDB) 7.2-2011.03-0</span><br><span class="line">Copyright (C) 2010 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">"show copying"</span></span><br><span class="line">and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"--host=x86_64-linux-gnu --target=arm-openwrt-linux-uclibcgnueabi"</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://bugs.launchpad.net/gdb-linaro/&gt;...</span><br><span class="line">Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/sbin/traffic_meter...done.</span><br><span class="line"></span><br><span class="line">warning: <span class="built_in">exec</span> file is newer than core file.</span><br><span class="line">[New Thread 14189]</span><br><span class="line">Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libgcc_s.so.1...done.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libgcc_s.so.1</span><br><span class="line">Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libc.so.0...done.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libc.so.0</span><br><span class="line">Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/ld-uClibc.so.0...done.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/ld-uClibc.so.0</span><br><span class="line">Core was generated by `traffic_meter -w brwan -p ppp0 -m /dev/mtd15`.</span><br><span class="line">Program terminated with signal 6, Aborted.</span><br><span class="line"><span class="comment">#0  0x402fb4fc in raise (sig=6) at libpthread/nptl/sysdeps/unix/sysv/linux/raise.c:67</span></span><br><span class="line">67        int res = INLINE_SYSCALL (tgkill, 3, pid, selftid, sig);</span><br><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  0x402fb4fc in raise (sig=6) at libpthread/nptl/sysdeps/unix/sysv/linux/raise.c:67</span></span><br><span class="line"><span class="comment">#1  0x402f579c in abort () at libc/stdlib/abort.c:89</span></span><br><span class="line"><span class="comment">#2  0x402f5060 in __malloc_consolidate (av=0x4030b3e8) at libc/stdlib/malloc-standard/free.c:234</span></span><br><span class="line"><span class="comment">#3  __malloc_consolidate (av=0x4030b3e8) at libc/stdlib/malloc-standard/free.c:170</span></span><br><span class="line"><span class="comment">#4  0x402f4854 in malloc (bytes=&lt;value optimized out&gt;) at libc/stdlib/malloc-standard/malloc.c:908</span></span><br><span class="line"><span class="comment">#5  0x402d6250 in _stdio_fopen (fname_or_mode=&lt;value optimized out&gt;, mode=&lt;value optimized out&gt;, stream=0x8ca0e8, filedes=8) at libc/stdio/_fopen.c:177</span></span><br><span class="line"><span class="comment">#6  0x402d4fb4 in popen (command=0x8 &lt;Address 0x8 out of bounds&gt;, modes=0xfc08 "r") at libc/stdio/popen.c:83</span></span><br><span class="line"><span class="comment">#7  0x0000f488 in config_get (name=&lt;value optimized out&gt;) at config.c:11</span></span><br><span class="line"><span class="comment">#8  0x0000ed48 in get_bogus_time_region (ct=60744, st=0xbe9f8994, btr=0xbe9f896c) at util.c:184</span></span><br><span class="line"><span class="comment">#9  0x0000e8f0 in get_traffic_from_flash (tfm=0xbe9f8738, ct=2894) at spi_flash.c:912</span></span><br><span class="line"><span class="comment">#10 0x0000ccb0 in restart_traffic_counter (tfm=0xbe9f8738, ct=52400) at trafficmeter.c:976</span></span><br><span class="line"><span class="comment">#11 0x0000a1f4 in main (argc=&lt;value optimized out&gt;, argv=&lt;value optimized out&gt;) at trafficmeter.c:1798</span></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>BackTrace (bt) 输出</strong>  </p>
<p>#num memory_addr in function (arg1=val1, arg2=val2,…) at file.c:line<br><code>bt</code>输出前面的编号是进程执行时的压栈顺序，编号越小越底层。编号后面紧跟的是内存地址，从地址大小可以看出哪些是内核调用，哪些是用户调用。  </p>
<p><strong>注意：</strong>由于编译器优化缘故，某些变量会显示<code>value optimized out</code>，如果想获取真实值，需要在编译时添加<code>-O0</code>，用以禁用编译器优化</p>
</blockquote>
<p>从<code>bt</code>结果可以看出，进程是在执行动态内存分配函数<code>malloc</code>时检测到错误，并执行<code>abort</code>函数触发<code>SIGABRT</code>信号后退出的。那就可以确定是内存问题，多半是内存多次释放或是未释放导致的。</p>
<p>据此线索，检查代码中与内存分配和释放相关的部分，最终调试发现是某处代码引用指针错误，并在之后使用<code>free</code>释放内存，而该指针指向的内存在多处地方被重新分配和释放，导致内存出现不可预料的问题。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>在分析<code>coredump</code>时，需要注意以下几点：</p>
<ol>
<li>交叉编译后的<code>GDB</code>可执行文件位于<code>build_dir/toolchain-arm_v7-a_gcc-4.6-linaro_uClibc-0.9.33.2_eabi/gdb-linaro-7.2-2011.03-0/gdb/gdb</code></li>
<li>注意当前调试路径最好是在编译完成后的根目录<code>root-ipq806x</code>, 否则<code>GDB</code>可能无法找到动态链接库的位置，从而无法找到库函数的<code>symbols</code>，此时可能出现以下情况</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">warning: <span class="built_in">exec</span> file is newer than core file.</span><br><span class="line">[New Thread 14189]</span><br><span class="line"></span><br><span class="line">warning: Could not load shared library symbols <span class="keyword">for</span> 3 libraries, e.g. /lib/libgcc_s.so.1.</span><br><span class="line">Use the <span class="string">"info sharedlibrary"</span> <span class="built_in">command</span> to see the complete listing.</span><br><span class="line">Do you need <span class="string">"set solib-search-path"</span> or <span class="string">"set sysroot"</span>?</span><br><span class="line"></span><br><span class="line">warning: Unable to find dynamic linker breakpoint <span class="keyword">function</span>.</span><br><span class="line">GDB will be unable to debug shared library initializers</span><br><span class="line">and track explicitly loaded dynamic code.</span><br><span class="line">Core was generated by `traffic_meter -w brwan -p ppp0 -m /dev/mtd15`.</span><br><span class="line">Program terminated with signal 6, Aborted.</span><br><span class="line"><span class="comment">#0  0x402fb4fc in ?? ()</span></span><br><span class="line">Setting up the environment <span class="keyword">for</span> debugging gdb.</span><br><span class="line">Function <span class="string">"internal_error"</span> not defined.</span><br><span class="line">Make breakpoint pending on future shared library load? (y or [n]) [answered N; input not from terminal]</span><br><span class="line">Function <span class="string">"info_command"</span> not defined.</span><br><span class="line">Make breakpoint pending on future shared library load? (y or [n]) [answered N; input not from terminal]</span><br><span class="line">.gdbinit:8: Error <span class="keyword">in</span> sourced <span class="built_in">command</span> file:</span><br><span class="line">Argument required (one or more breakpoint numbers).</span><br><span class="line">(gdb) info sharedlibrary</span><br><span class="line">From        To          Syms Read   Shared Object Library</span><br><span class="line">                        No          /lib/libgcc_s.so.1</span><br><span class="line">                        No          /lib/libc.so.0</span><br><span class="line">                        No          /lib/ld-uClibc.so.0</span><br><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  0x402fb4fc in ?? ()</span></span><br><span class="line"><span class="comment">#1  0x402f579c in ?? ()</span></span><br><span class="line"><span class="comment">#2  0x402f579c in ?? ()</span></span><br><span class="line">Backtrace stopped: previous frame identical to this frame (corrupt stack?)</span><br></pre></td></tr></table></figure>
<p>若出现以上情况，我们得不到任何有效信息，此时可以通过提示的<code>set solib-search-path</code>或<code>set sysroot</code>手动设置库路径或根目录路径。但我仍建议在调试前<code>cd</code>到根目录。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol>
<li><a href="https://blog.51cto.com/terrytong914/1905041" target="_blank" rel="noopener">Linux coredump解决流程</a></li>
<li><a href="https://wiki.openwrt.org/doc/devel/gdb?s[]=gdb" target="_blank" rel="noopener">GNU Debugger</a></li>
<li><a href="https://www.tutorialspoint.com/gnu_debugger/gdb_debugging_symbols.htm" target="_blank" rel="noopener">GDB - Debugging Symbols</a></li>
<li><a href="http://man7.org/linux/man-pages/man5/core.5.html" target="_blank" rel="noopener">Core dump file</a></li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://www.litreily.top/2018/09/20/coredump/" data-id="cjreqvswn004dmvwtpe28v2em" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3ay27DIBAF0P7/T7vbSk2ce8FuZTisojiROSxGzOPrK17HjzXz/e/ftP+aWhgYGI9lHKdrfrvnb3n3NN8bBgbGPozzgHhVqM23nu8NAwMD45yR/P5DoCzfi4GBgTG2rSR0vgvH/xZwMTAwHsjINzRzKUye3p6LY2BgPJCRV93//vMt/Q0MDIxHMY5ytQ3ImVBe7AoDA2NpRh7gWkxyoSwS1GQ/GBgYizLacYex4YyxlkAxzIGBgbE046qEc+wI2uLdh39hYGAsysjD5VhLIA+4+btehGYMDIylGe0IV9uGTFLfNpWNym0YGBgLMcYaim2LcSaVjf6LgYGxJaMt67eFtpkW6YtvMDAwlmbkV7H8utaOeV2c4mJgYGzGmHn92LbydmZ0TcTAwFiCkRf989Q3ObPzxkN7KBgYGPsw2oJafvkbuz7WwxYYGBgbMI54zZTD7hh7xcDA2IExs+n2Ijh2rFEzAAMDY1HGWH2uHXi944JYtAQwMDCWY+TjEXn6mjcS2oA72B7AwMB4LCMvvbUF/XZQLK/5Y2Bg7MbIA+vgNMdQO6FIhjEwMBZlHOVqm4tjxbj6KDEwMJZmXBWzZ1LTPE2Nim4YGBiLMtoWZruJPOyOtRkwMDD2YeQJZzs8kVMvSGUxMDAwyoA7E0DbpxgYGBhtiGwvgkmQ/dCEwMDA2ICRNwPGGgntha8+JgwMjKUZeerYpqYzm5gZR8PAwFiI8Q1Cb9sZSdSCoQAAAABJRU5ErkJggg==">Share</a><div class="tags"><a href="/tags/C-C/">C/C++</a><a href="/tags/linux/">linux</a></div><div class="post-nav"><a class="pre" href="/2018/09/27/tee/">Linux指令 - tee的实现</a><a class="next" href="/2018/08/31/pug-synax/">网页模板pug基本语法</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'1ecKy4yk4u1R7C4tScKbnyq9-gzGzoHsz',
  appKey:'uvA3xgqNW3q8TGR483lxXcpB',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/LabVIEW/">LabVIEW</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Matlab/">Matlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Media/">Media</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/嵌入式/">嵌入式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂物柜/">杂物柜</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/word/" style="font-size: 12px;">word</a> <a href="/tags/test/" style="font-size: 15.43px;">test</a> <a href="/tags/jekyll/" style="font-size: 15.43px;">jekyll</a> <a href="/tags/ruby/" style="font-size: 13.71px;">ruby</a> <a href="/tags/algorithm/" style="font-size: 20.57px;">algorithm</a> <a href="/tags/literature/" style="font-size: 12px;">literature</a> <a href="/tags/windows/" style="font-size: 13.71px;">windows</a> <a href="/tags/matlab/" style="font-size: 17.14px;">matlab</a> <a href="/tags/labview/" style="font-size: 22.29px;">labview</a> <a href="/tags/tdms/" style="font-size: 13.71px;">tdms</a> <a href="/tags/brackets/" style="font-size: 12px;">brackets</a> <a href="/tags/git/" style="font-size: 15.43px;">git</a> <a href="/tags/tools/" style="font-size: 17.14px;">tools</a> <a href="/tags/utorrent/" style="font-size: 12px;">utorrent</a> <a href="/tags/C-C/" style="font-size: 24px;">C/C++</a> <a href="/tags/ubuntu/" style="font-size: 22.29px;">ubuntu</a> <a href="/tags/linux/" style="font-size: 18.86px;">linux</a> <a href="/tags/atom/" style="font-size: 13.71px;">atom</a> <a href="/tags/music/" style="font-size: 13.71px;">music</a> <a href="/tags/signal/" style="font-size: 13.71px;">signal</a> <a href="/tags/VS/" style="font-size: 13.71px;">VS</a> <a href="/tags/stm32/" style="font-size: 13.71px;">stm32</a> <a href="/tags/hexo/" style="font-size: 13.71px;">hexo</a> <a href="/tags/RSS/" style="font-size: 12px;">RSS</a> <a href="/tags/Feed/" style="font-size: 12px;">Feed</a> <a href="/tags/FreeRTOS/" style="font-size: 12px;">FreeRTOS</a> <a href="/tags/log/" style="font-size: 12px;">log</a> <a href="/tags/office/" style="font-size: 12px;">office</a> <a href="/tags/video/" style="font-size: 12px;">video</a> <a href="/tags/makefile/" style="font-size: 13.71px;">makefile</a> <a href="/tags/wireshark/" style="font-size: 12px;">wireshark</a> <a href="/tags/telnet/" style="font-size: 12px;">telnet</a> <a href="/tags/smtp/" style="font-size: 12px;">smtp</a> <a href="/tags/tmux/" style="font-size: 13.71px;">tmux</a> <a href="/tags/shell/" style="font-size: 12px;">shell</a> <a href="/tags/mysql/" style="font-size: 12px;">mysql</a> <a href="/tags/centos/" style="font-size: 12px;">centos</a> <a href="/tags/ddos/" style="font-size: 12px;">ddos</a> <a href="/tags/hping3/" style="font-size: 12px;">hping3</a> <a href="/tags/spider/" style="font-size: 17.14px;">spider</a> <a href="/tags/sina/" style="font-size: 12px;">sina</a> <a href="/tags/lofter/" style="font-size: 12px;">lofter</a> <a href="/tags/scrapy/" style="font-size: 12px;">scrapy</a> <a href="/tags/pug/" style="font-size: 12px;">pug</a> <a href="/tags/queue/" style="font-size: 12px;">queue</a> <a href="/tags/xlwt/" style="font-size: 12px;">xlwt</a> <a href="/tags/sort/" style="font-size: 12px;">sort</a> <a href="/tags/visualization/" style="font-size: 13.71px;">visualization</a> <a href="/tags/ssh/" style="font-size: 12px;">ssh</a> <a href="/tags/proxy/" style="font-size: 12px;">proxy</a> <a href="/tags/vps/" style="font-size: 12px;">vps</a> <a href="/tags/stdio/" style="font-size: 12px;">stdio</a> <a href="/tags/cache/" style="font-size: 12px;">cache</a> <a href="/tags/buffer/" style="font-size: 12px;">buffer</a> <a href="/tags/pypcap/" style="font-size: 12px;">pypcap</a> <a href="/tags/dpkt/" style="font-size: 12px;">dpkt</a> <a href="/tags/MongoDB/" style="font-size: 12px;">MongoDB</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/22/highcharts/">Python之MongoDB数据分析及其Highcharts可视化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/31/pypcap-install/">Python之pypcap库的安装及简单抓包工具的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/25/autossh/">autossh反向代理实现内网穿透</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/25/io-cache/">Linux中的文件I/O缓冲</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/tee/">Linux指令 - tee的实现</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://www.smslit.top" title="smslit-水木十里" target="_blank">smslit-水木十里</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">LITREILY.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> manupassant.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>